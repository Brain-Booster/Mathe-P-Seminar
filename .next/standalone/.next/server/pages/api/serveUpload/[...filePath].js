"use strict";(()=>{var e={};e.id=904,e.ids=[904],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},1307:(e,r,t)=>{t.r(r),t.d(r,{config:()=>u,default:()=>f,routeModule:()=>m});var i={};t.r(i),t.d(i,{default:()=>c});var o=t(1802),s=t(7153),l=t(6249),a=t(2048),n=t.n(a),p=t(5315),d=t.n(p);async function c(e,r){try{let t=d().join(process.cwd(),"public","uploads"),{filePath:i}=e.query;if(!i||!Array.isArray(i)||0===i.length)return r.status(400).json({error:"Invalid file path"});let o=d().join(t,...i);if(!n().existsSync(o))return r.status(404).json({error:"File not found"});let s=i[i.length-1],l=d().extname(s).toLowerCase(),a=".pdf"===l?"application/pdf":"application/octet-stream";r.setHeader("Content-Type",a);let p="application/pdf"===a?"inline":"attachment";r.setHeader("Content-Disposition",`${p}; filename="${s}"`),n().createReadStream(o).pipe(r)}catch(e){console.error("Error serving file:",e),r.status(500).json({error:"Internal server error"})}}t(8989);let f=(0,l.l)(i,"default"),u=(0,l.l)(i,"config"),m=new o.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/serveUpload/[...filePath]",pathname:"/api/serveUpload/[...filePath]",bundlePath:"",filename:""},userland:i})},8989:(e,r,t)=>{t.d(r,{X:()=>a});var i=t(2048),o=t.n(i),s=t(5315),l=t.n(s);class a{constructor(){let e=l().join(process.cwd(),"public");this.imageDir=l().join(e,"uploads","images"),this.pdfDir=l().join(e,"uploads","pdfs"),this.modelDir=l().join(e,"uploads","models"),[this.imageDir,this.pdfDir,this.modelDir].forEach(e=>{o().existsSync(e)||o().mkdirSync(e,{recursive:!0})}),this.allowedFileTypes={images:["jpg","jpeg","png","webp"],pdfs:["pdf"],models:["glb","gltf","obj","stl","fbx"]},this.maxFileSize={images:10485760,pdfs:52428800,models:104857600}}async uploadFile(e,r,t=""){try{if(!e||!r)throw Error("File and fileType are required");let s=r;!this.allowedFileTypes[s]&&this.allowedFileTypes[`${s}s`]&&(s=`${s}s`);let a=e.originalFilename||l().basename(e.filepath),n=l().extname(a).toLowerCase().slice(1);if(!this.allowedFileTypes[s]?.includes(n))throw Error(`Invalid file type. Expected: ${this.allowedFileTypes[s]?.join(", ")||"unknown type"}`);if(!this.maxFileSize[s])throw Error("File type not supported");if(e.size>this.maxFileSize[s])throw Error(`File too large. Max size: ${this.maxFileSize[s]/1024/1024}MB`);let p=Date.now(),d=l().extname(a).toLowerCase(),c=l().basename(a,d).replace(/[^a-zA-Z0-9]/g,"_"),f=`${p}-${c}${d}`,u=this.getFilePath(s,t),m=l().join(u,f);console.log("FileHandler: saving file to",m);let h=l().dirname(m);if(o().existsSync(h)||o().mkdirSync(h,{recursive:!0}),await i.promises.rename(e.filepath,m),!o().existsSync(m))throw Error("File failed to save");return{path:l().relative(process.cwd(),m),url:this.getFileUrl(s,f),size:e.size,type:e.mimetype}}catch(e){throw console.error("Error uploading file:",e),e}}getFilePath(e,r=""){let t;if("images"===e)t=this.imageDir;else if("pdfs"===e)t=this.pdfDir;else if("models"===e)t=this.modelDir;else throw Error("Unsupported file type");let i=r?l().join(t,r):t;return o().existsSync(i)||o().mkdirSync(i,{recursive:!0}),i}getFileUrl(e,r){return`/api/serveUpload/${e}/${r}`}async serveFile(e,r){try{if(e.includes("..")){r.status(403).json({error:"Invalid path"});return}let t=l().join(process.cwd(),e);if(!o().existsSync(t)){r.status(404).json({error:"File not found"});return}let i=l().extname(e).toLowerCase(),s="application/octet-stream";".jpg"===i||".jpeg"===i?s="image/jpeg":".png"===i?s="image/png":".pdf"===i?s="application/pdf":".glb"===i?s="model/gltf-binary":".gltf"===i?s="model/gltf+json":".obj"===i?s="model/obj":".stl"===i?s="model/stl":".fbx"===i&&(s="model/fbx"),r.setHeader("Content-Type",s);{let e=Object.keys(this.allowedFileTypes).find(e=>this.allowedFileTypes[e].includes(i.slice(1)));r.setHeader("Cache-Control",{image:"public, max-age=31536000",pdf:"public, max-age=604800",model:"public, max-age=2592000"}[e]||"public, max-age=31536000")}r.setHeader("X-Content-Type-Options","nosniff"),r.setHeader("X-Frame-Options","DENY"),r.setHeader("X-XSS-Protection","1; mode=block");let a=o().createReadStream(t);a.pipe(r),a.on("error",e=>{console.error("Error reading file:",e),r.status(500).json({error:"Error reading file"})}),r.on("close",()=>{a.destroy()})}catch(e){console.error("Error serving file:",e),r.status(500).json({error:"Internal server error"})}}}},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=1307);module.exports=t})();